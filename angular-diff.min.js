"use strict";angular.module("diff",[]).filter("diff",["$sce",function(t){function e(t){var e=t;return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;")}function r(t,r){t=t.replace(/\s+$/,""),r=r.replace(/\s+$/,"");var n,l=o(""===t?[]:t.split(/\s+/),""===r?[]:r.split(/\s+/)),s="",w=t.match(/\s+/g);null===w?w=["\n"]:w.push("\n");var u=r.match(/\s+/g);if(null===u?u=["\n"]:u.push("\n"),1==l.o.length&&1==l.n.length){var f="",g="";return f=l.o[0].text?l.o[0].text:l.o[0],g=l.n[0].text?l.n[0].text:l.n[0],f!=g?(s+="<del>"+e(f)+"</del>",s+="<ins>"+e(g)+"</ins>"):s=g,s}if(0===l.n.length)for(n=0;n<l.o.length;n++)s+="<del>"+e(l.o[n])+w[n]+"</del>";else{if(null===l.n[0].text)for(r=0;r<l.o.length&&null===l.o[r].text;r++)s+="<del>"+e(l.o[r])+w[r]+"</del>";if(l.n[0].row>0)for(r=0;r<l.n[0].row;r++){var i=l.o[r].constructor==Object?l.o[r].text:l.o[r];s+="<del>"+e(i)+w[r]+"</del>"}for(n=0;n<l.n.length;n++)if(l.n[n].text){var x="";for(r=l.n[n].row+1;r<l.o.length&&!l.o[r].text;r++)x+="<del>"+e(l.o[r])+w[r]+"</del>";s+=" "+l.n[n].text+u[n]+x}else s+="<ins>"+e(l.n[n])+u[n]+"</ins>"}return s}function o(t,e){var r,o={},n={};for(r=0;r<e.length;r++)o[e[r]]||(o[e[r]]={rows:[],o:null}),o[e[r]].rows.push(r);for(r=0;r<t.length;r++)n[t[r]]||(n[t[r]]={rows:[],n:null}),n[t[r]].rows.push(r);for(r in o)1===o[r].rows.length&&"undefined"!=typeof n[r]&&1===n[r].rows.length&&(e[o[r].rows[0]]={text:e[o[r].rows[0]],row:n[r].rows[0]},t[n[r].rows[0]]={text:t[n[r].rows[0]],row:o[r].rows[0]});for(r=0;r<e.length-1;r++)null!==e[r].text&&null===e[r+1].text&&e[r].row+1<t.length&&!t[e[r].row+1].text&&e[r+1]===t[e[r].row+1]&&(e[r+1]={text:e[r+1],row:e[r].row+1},t[e[r].row+1]={text:t[e[r].row+1],row:r+1});for(r=e.length-1;r>0;r--)e[r].text&&!e[r-1].text&&e[r].row>0&&!t[e[r].row-1].text&&e[r-1]===t[e[r].row-1]&&(e[r-1]={text:e[r-1],row:e[r].row-1},t[e[r].row-1]={text:t[e[r].row-1],row:r-1});return{o:t,n:e}}return function(e,o){return t.trustAsHtml(r(e,o))}}]);